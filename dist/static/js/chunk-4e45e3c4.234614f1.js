(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4e45e3c4"],{"0b2b":function(e,t,n){"use strict";var s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"transferLimit"},[e.isExport?n("el-button",{attrs:{type:"primary"},on:{click:e.exportTable}},[e._v("导出Excel")]):e._e(),e.permissionsData.length>0?n("el-table",{staticStyle:{width:"100%"},attrs:{id:"out-table",data:e.permissionsData,border:"","row-key":"id","span-method":e.objectSpanMethod}},[n("el-table-column",{attrs:{prop:"category_name",label:"模块",width:"100"}}),n("el-table-column",{attrs:{prop:"name",label:"菜单",width:"180"}}),n("el-table-column",{attrs:{label:"权限"},scopedSlots:e._u([{key:"header",fn:function(t){return[e._v(" 权限 "),e.exportBool?e._e():n("el-checkbox",{staticStyle:{"margin-left":"20px"},on:{change:e.checkAllChange},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[e._v("全选")]),e._e()]}},{key:"default",fn:function(t){return[e.exportBool?e._e():n("el-checkbox",{on:{change:function(n){return e.handleCheckAllChange(n,t.row,t.row.permissions)}},model:{value:t.row.checkAll,callback:function(n){e.$set(t.row,"checkAll",n)},expression:"scope.row.checkAll"}},[e._v("全选")]),n("div",{staticStyle:{margin:"15px 0"}}),n("el-checkbox-group",{on:{change:function(n){return e.handleCheckedCitiesChange(n,t.row)}},model:{value:t.row.checkedCities,callback:function(n){e.$set(t.row,"checkedCities",n)},expression:"scope.row.checkedCities"}},e._l(t.row.permissions,(function(s,i){return n("el-checkbox",{key:s.id,attrs:{label:s.id}},[e._v(e._s(s.name)+" "),e.exportBool&&t.row.permissions.length!==i+1?n("span",[e._v("、")]):e._e()])})),1)]}}],null,!1,13267486)})],1):e._e()],1)},i=[],o=n("2909"),r=(n("a9e3"),n("d3b7"),n("159b"),n("4de4"),n("b0c0"),n("caad"),n("b775")),a=n("99b1");function c(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s={url:t?a["a"].PermissionUrl+t+"/":a["a"].PermissionUrl,method:e};return Object.assign(s,n),Object(r["a"])(s)}var l=n("ed08"),u={props:{defaultPermissions:{type:Array,default:function(){return[]}},disable:{type:Boolean,default:!1},groupId:{type:Number,default:0},menu:{type:[Number,String],default:""},category:{type:[Number,String],default:""},isExport:{type:Boolean,default:!1},sectionId:{type:[Number,String],default:""},viewSectionPermission:{type:Boolean,default:!1}},data:function(){return{permissionsData:[],loading:!1,checkAll:!1,permissionsDataAll:[],exportBool:!1,spanArr:[],pos:null}},computed:{},watch:{groupId:function(){this.checkAll=!1,this.permissionsData.forEach((function(e){e.permissions.forEach((function(e){e.checkedCities=[]})),e.checkAll=!1})),this.getPermissions()},disable:function(e){e&&(this.checkAll=!1,this.permissionsData.forEach((function(e){e.permissions.forEach((function(e){e.checkedCities=[]})),e.checkAll=!1})),this.getPermissions())},sectionId:function(){this.checkAll=!1,this.permissionsData.forEach((function(e){e.permissions.forEach((function(e){e.checkedCities=[]})),e.checkAll=!1})),this.sectionId||this.getPermissions()},menu:function(e){this.checkAll=!1,this.permissionsData=e?this.permissionsDataAll.filter((function(t){return t.name.toLowerCase().indexOf(e.toLowerCase())>-1})):this.permissionsDataAll},category:function(e){this.checkAll=!1,this.permissionsData=e?this.permissionsDataAll.filter((function(t){return t.category_name.toLowerCase().indexOf(e.toLowerCase())>-1})):this.permissionsDataAll}},mounted:function(){this.getPermissions()},methods:{getPermissions:function(){var e=this;this.permissionsData=[],this.loading=!0;var t={};this.viewSectionPermission?t.view_section_permission=1:delete t.view_section_permission,this.loading=!0,c("get",null,{params:t}).then((function(t){var n=t.result||[];e.permissionsData=n,e.permissionsList=n,e.spanArr=[],e.pos=null,e.permissionsData.forEach((function(t,n){var s=[];t.permissions.forEach((function(t){e.defaultPermissions&&e.defaultPermissions.length?e.defaultPermissions.forEach((function(e){t.id===e&&(t.has_permission=!0,s.push(t.id))})):t.has_permission&&s.push(t.id)})),t.permissions.length===s.length?e.$set(t,"checkAll",!0):e.$set(t,"checkAll",!1),e.$set(t,"checkedCities",s),0===n?(e.spanArr.push(1),e.pos=0):e.permissionsData[n].category_name===e.permissionsData[n-1].category_name?(e.spanArr[e.pos]+=1,e.spanArr.push(0)):(e.spanArr.push(1),e.pos=n)})),e.permissionsDataAll=e.permissionsData,e.loading=!1})).catch((function(){e.loading=!1}))},handleCheckAllChange:function(e,t,n){var s=[];n.forEach((function(e){s.push(e.id)})),t.checkedCities=e?s:[],this.setPermissionsData()},handleCheckedCitiesChange:function(e,t){var n=e.length;t.checkAll=n===t.permissions.length,this.setPermissionsData()},setPermissionsData:function(e){var t=[];this.permissionsList.forEach((function(e){t.push.apply(t,Object(o["a"])(e.checkedCities))})),this.$emit("changeTransferPermissions",t)},checkAllChange:function(e){var t=this;this.permissionsData.forEach((function(n){var s=[];n.permissions.forEach((function(t){t.has_permission=e,t.has_permission&&s.push(t.id)})),n.permissions.length===s.length?t.$set(n,"checkAll",!0):t.$set(n,"checkAll",!1),t.$set(n,"checkedCities",s)})),this.setPermissionsData()},exportTable:function(){var e=this;this.exportBool=!0,setTimeout((function(t){Object(l["d"])("权限"),e.exportBool=!1}),300)},objectSpanMethod:function(e){e.row,e.column;var t=e.rowIndex,n=e.columnIndex;if([0].includes(n)&&this.spanArr){var s=this.spanArr[t],i=s>0?1:0;return{rowspan:s,colspan:i}}}}},p=u,m=(n("8c3f"),n("2877")),h=Object(m["a"])(p,s,i,!1,null,"67490ef9",null);t["a"]=h.exports},"377f":function(e,t,n){"use strict";n("c3ea")},"3e51":function(e,t,n){"use strict";var s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticStyle:{display:"flex","margin-top":"2px"}},[e.oldPage?n("el-pagination",{attrs:{disabled:!0,"current-page":e._currentPage,layout:"total,prev,pager,next","page-size":e.pageSize,total:e.total},on:{"update:currentPage":function(t){e._currentPage=t},"update:current-page":function(t){e._currentPage=t},"current-change":function(t){return e.currentChange(t,e.pageSize)}}}):n("div",{staticClass:"page-style",staticStyle:{display:"flex"}},[n("el-pagination",{attrs:{"current-page":e._currentPage,"page-sizes":e.options,"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total,background:""},on:{"size-change":function(t){return e.currentChange(1,t)},"current-change":function(t){return e.currentChange(t,e.pageSize)}}})],1)],1)},i=[],o=(n("a9e3"),{props:{total:{type:Number,default:0},pageSizeProps:{type:Number,default:10},currentPage:{type:Number,default:1},oldPage:{type:Boolean,default:!0}},data:function(){return{pageSize:this.pageSizeProps,options:[10,50,100]}},computed:{_currentPage:{get:function(){return this.currentPage},set:function(){return 1}}},methods:{currentChange:function(e,t){t&&(this.pageSize=t),this.oldPage?this.$emit("currentChange",e):this.$emit("currentChange",e,t)}}}),r=o,a=(n("aaaa"),n("2877")),c=Object(a["a"])(r,s,i,!1,null,null,null);t["a"]=c.exports},"8c3f":function(e,t,n){"use strict";n("9975")},9975:function(e,t,n){},aaaa:function(e,t,n){"use strict";n("feac")},c3ea:function(e,t,n){},ecdc:function(e,t,n){"use strict";n.r(t);var s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"roles-manage"},[n("el-form",{staticClass:"top-search-box",attrs:{inline:!0}},[n("el-form-item",{attrs:{label:"角色"}},[n("el-input",{on:{input:e.groupCodeChanged},model:{value:e.getParams.group_code,callback:function(t){e.$set(e.getParams,"group_code",t)},expression:"getParams.group_code"}})],1),n("el-form-item",{attrs:{label:"角色名"}},[n("el-input",{on:{input:e.nameChanged},model:{value:e.getParams.name,callback:function(t){e.$set(e.getParams,"name",t)},expression:"getParams.name"}})],1),n("el-form-item",{attrs:{label:"是否使用"}},[n("el-select",{attrs:{clearable:"",placeholder:"请选择"},on:{change:e.nameChanged},model:{value:e.getParams.is_used,callback:function(t){e.$set(e.getParams,"is_used",t)},expression:"getParams.is_used"}},e._l(e.optionsUser,(function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),n("el-form-item",[n("el-button",{attrs:{type:"success",icon:"el-icon-search",size:"small"},on:{click:e.nameChanged}},[e._v("搜索")])],1)],1),n("div",{staticClass:"center-box"},[n("div",{staticClass:"botton-box"},[n("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["group_extension","add"],expression:"['group_extension','add']"}],attrs:{type:"blue",icon:"el-icon-plus",size:"small"},on:{click:e.showCreateGroupDialog}},[e._v("新建")]),n("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["group_extension","update"],expression:"['group_extension','update']"}],staticStyle:{"margin-left":"8px"},attrs:{type:"danger",icon:"el-icon-turn-off",size:"small"},on:{click:function(t){return e.useFun("禁用")}}},[e._v("禁用")]),n("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["group_extension","update"],expression:"['group_extension','update']"}],attrs:{type:"danger",icon:"el-icon-open",size:"small"},on:{click:function(t){return e.useFun("启用")}}},[e._v("启用")]),n("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["group_extension","delete"],expression:"['group_extension','delete']"}],attrs:{type:"danger",icon:"el-icon-delete",size:"small"},on:{click:e.deleteFun}},[e._v("删除")])],1),n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingTable,expression:"loadingTable"}],staticStyle:{width:"100%",padding:"0 10px 0 10px"},attrs:{data:e.tableData,"tooltip-effect":"dark",stripe:""},on:{"selection-change":e.handleSelectionChange}},[n("el-table-column",{attrs:{type:"selection",width:"40"}}),n("el-table-column",{attrs:{prop:"group_code",label:"角色代码"}}),n("el-table-column",{attrs:{prop:"name",label:"角色名称"}}),n("el-table-column",{attrs:{prop:"is_used",label:"使用",width:"80",formatter:e.formatter}}),n("el-table-column",{attrs:{label:"创建人"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.created_username?t.row.created_username:"--")+" ")]}}])}),n("el-table-column",{attrs:{prop:"created_time",label:"创建时间"}}),n("el-table-column",{attrs:{label:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button-group",[n("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["group_extension","change"],expression:"['group_extension','change']"}],attrs:{size:"mini",type:"text"},on:{click:function(n){return e.showEditGroupDialog(t.row)}}},[e._v("修改 ")])],1)]}}])})],1)],1),n("el-footer",{attrs:{id:"footer"}},[n("page",{attrs:{"old-page":!1,total:e.count,"current-page":e.getParams.page},on:{currentChange:e.changePage}})],1),n("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogEditGroupVisible,"close-on-click-modal":!1,width:"800px","before-close":e.handleClose},on:{"update:visible":function(t){e.dialogEditGroupVisible=t}}},[n("el-form",{ref:"groupForm",attrs:{model:e.groupForm}},[n("el-row",[n("el-col",{attrs:{span:12}},[n("el-form-item",{attrs:{error:e.groupFormError.group_code,label:"角色代码"}},[n("el-input",{attrs:{disabled:""},model:{value:e.groupForm.group_code,callback:function(t){e.$set(e.groupForm,"group_code",t)},expression:"groupForm.group_code"}})],1)],1),n("el-col",{attrs:{span:12}},[n("el-form-item",{attrs:{error:e.groupFormError.name,label:"角色名称"}},[n("el-input",{model:{value:e.groupForm.name,callback:function(t){e.$set(e.groupForm,"name",t)},expression:"groupForm.name"}})],1)],1)],1),n("el-row",[n("el-col",{attrs:{span:12}},[n("el-form-item",{attrs:{label:"菜单筛选"}},[n("el-input",{attrs:{clearable:""},on:{input:e.changeList},model:{value:e.permission_name,callback:function(t){e.permission_name=t},expression:"permission_name"}})],1)],1)],1),n("el-form-item",{attrs:{label:"权限设置",size:"medium"}},[n("transferLimit",{ref:"Permission",attrs:{"view-section-permission":!0,"section-id":e.departmentId,"default-permissions":e.groupForm.permissions},on:{changeTransferPermissions:e.changeTransferPermissions}})],1)],1),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){return e.handleClose(!1)}}},[e._v("取 消")]),n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleEditGroup("groupForm")}}},[e._v("确 定")])],1)],1)],1)},i=[],o=n("5530"),r=n("c7eb"),a=n("1da1"),c=(n("d3b7"),n("159b"),n("b0c0"),n("e9c4"),n("4de4"),n("6c18")),l=n("3e51"),u=n("0b2b"),p=n("ed08"),m=n("b775"),h=n("99b1");function d(e){return Object(m["a"])({url:h["a"].CommonCode,method:"get",params:e})}var g=n("a78e"),f=n.n(g),b={name:"GroupManage",components:{page:l["a"],transferLimit:u["a"]},data:function(){return{getParams:{page:1,is_used:null},tableData:[],count:0,group_code:"",name:"",permission_name:"",groupForm:{name:"",group_code:"",is_used:!0},groupFormError:{name:"",group_code:"",is_used:""},permissions:[],dialogEditGroupVisible:!1,dialogTitle:"新增角色",loading:!0,loadingTable:!1,optionsUser:[{value:1,label:"Y"},{value:0,label:"N"}],currentVal:[],optionsSection:[],is_superuser:f.a.get("is_superuser"),departmentId:""}},computed:{},created:function(){this.currentChange()},mounted:function(){this.getOptionsSection()},methods:{checkPermission:p["a"],handleSelectionChange:function(e){this.currentVal=e||[]},useFun:function(e){var t=this;if(this.currentVal.length){var n=[],s=[];this.currentVal.forEach((function(t){"禁用"===e&&t.is_used?n.push(t.id):"启用"!==e||t.is_used||n.push(t.id)})),this.currentVal.forEach((function(e){s.push(e.name)})),this.$confirm("此操作".concat(e,", 是否继续?"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.$store.dispatch("settings/operateTypeSetting",e),Object(c["n"])("post",null,{data:{obj_ids:n}}).then((function(e){t.$message({type:"success",message:"操作成功!"}),t.nameChanged()})).catch((function(){}))})).catch((function(){}))}else this.$message("请选择列表数据")},deleteFun:function(){var e=this;if(this.currentVal.length){var t=[],n=[];this.currentVal.forEach((function(e){t.push(e.id)})),this.currentVal.forEach((function(e){n.push(e.name)})),this.$confirm("此操作删除不可逆, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.$store.dispatch("settings/operateTypeSetting","删除"),Object(c["m"])("post",null,{data:{obj_ids:t}}).then((function(t){e.$message({type:"success",message:"操作成功!"}),e.nameChanged()})).catch((function(){}))})).catch((function(){}))}else this.$message("请选择列表数据")},currentChange:function(){var e=this;this.loadingTable=!0,Object(c["l"])("get",null,{params:this.getParams}).then((function(t){e.loading=!1,e.loadingTable=!1,e.count=t.count||0,e.tableData=t.results||[]})).catch((function(t){e.loading=!1,e.loadingTable=!1}))},getOptionsSection:function(){var e=this;return Object(a["a"])(Object(r["a"])().mark((function t(){var n;return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,"true"!==e.is_superuser){t.next=8;break}return t.next=4,Object(c["o"])("get");case 4:n=t.sent,n.results&&n.results[0].children.length>0?(e.optionsSection=n.results[0].children,e.optionsSection=v(e.optionsSection),e.optionsSection.forEach((function(e){delete e.children}))):e.optionsSection=[],t.next=10;break;case 8:e.optionsSection=e.permission_section,e.optionsSection.forEach((function(e){e.label=e.name}));case 10:t.next=14;break;case 12:t.prev=12,t.t0=t["catch"](0);case 14:case"end":return t.stop()}}),t,null,[[0,12]])})))()},formatter:function(e,t){return e.is_used?"Y":"N"},changePage:function(e,t){this.getParams.page=e,this.getParams.page_size=t,this.currentChange()},groupCodeChanged:function(){this.getParams["page"]=1,this.currentChange()},nameChanged:function(){this.getParams["page"]=1,this.currentChange()},clearGroupForm:function(){this.groupForm={name:"",group_code:"",is_used:!0,section:""},this.departmentId="",this.permission_name=""},clearGroupFormError:function(){this.groupFormError={name:"",group_code:"",is_used:""}},showCreateGroupDialog:function(){this.permission_name=null,this.getCode(3),this.clearGroupForm(),this.clearGroupFormError(),this.dialogTitle="新增角色",this.dialogEditGroupVisible=!0},getCode:function(e){var t=this;return Object(a["a"])(Object(r["a"])().mark((function n(){var s,i;return Object(r["a"])().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,d({code:e});case 3:s=n.sent,i=s.results,t.groupForm.group_code=i,n.next=10;break;case 8:n.prev=8,n.t0=n["catch"](0);case 10:case"end":return n.stop()}}),n,null,[[0,8]])})))()},handleEditGroup:function(){var e=this;if(this.clearGroupFormError(),this.groupForm.name){var t=this.groupForm.id?"put":"post",n=this.groupForm.id?this.groupForm.id:"",s=JSON.parse(JSON.stringify(this.groupForm));s.section instanceof Array&&(s.section=s.section[0]),this.groupForm.id?this.$store.dispatch("settings/operateTypeSetting","变更"):this.$store.dispatch("settings/operateTypeSetting","新增"),Object(c["l"])(t,n,{data:Object(o["a"])({},s)}).then((function(t){e.dialogEditGroupVisible=!1,e.$message.success(e.groupForm.name+e.groupForm.id?"编辑成功":"创建成功"),e.groupForm.id=null,e.currentChange(),e.handleClose(!1)})).catch()}else this.$message("请填写角色名称")},showEditGroupDialog:function(e){this.permission_name=null,this.groupForm=JSON.parse(JSON.stringify(e)),this.departmentId=this.groupForm.section,this.clearGroupFormError(),this.dialogTitle="编辑角色",this.dialogEditGroupVisible=!0},changeList:function(){var e=this;""!==this.permission_name?this.$refs["Permission"].permissionsData=this.$refs["Permission"].permissionsList.filter((function(t){return-1!==t.name.indexOf(e.permission_name)})):this.$refs["Permission"].permissionsData=this.$refs["Permission"].permissionsList},changeTransferPermissions:function(e){this.$set(this.groupForm,"permissions",e)},handleClose:function(e){this.groupForm.id=null,this.dialogEditGroupVisible=!1,this.departmentId=null,e&&e()},changeSection:function(e){e&&(this.$set(this.groupForm,"permissions",[]),this.departmentId=e[0])}}};function v(e){var t=[];return e.forEach((function(e){var n=Object(o["a"])({},e);n.children.length>0?n.children=v(n.children):delete n.children,t.push(n)})),t}var _=b,k=(n("377f"),n("2877")),x=Object(k["a"])(_,s,i,!1,null,null,null);t["default"]=x.exports},feac:function(e,t,n){}}]);